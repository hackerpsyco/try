{% extends "facilitator/shared/base.html" %}

{% block content %}
<h5 class="fw-bold mb-3">
  {{ class_section.class_level }} â€” Todayâ€™s Session
</h5>

{% if planned_session %}
<div class="card shadow-sm">
  <div class="card-body">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <span class="badge bg-primary">
        Day {{ planned_session.day_number }}
      </span>

      {% if session_status == "holiday" %}
        <span class="badge bg-warning">Holiday</span>

      {% elif session_status == "cancelled" %}
        <span class="badge bg-danger">Cancelled</span>

      {% elif session_status == "pending" %}
        <span class="badge bg-success">Ready to Start</span>
      {% endif %}
    </div>

    <!-- Topic -->
    <h6 class="fw-semibold">
      {{ planned_session.topic }}
    </h6>

    <!-- Info message -->
    {% if actual_session and session_status != "pending" %}
      {% if is_today %}
        <div class="alert alert-info my-2">
          ğŸŒ¤ï¸ This session was marked <strong>{{ session_status }}</strong>
          today ({{ actual_session.date }}). <br>
          It will be conducted on the next working day.
        </div>
      {% else %}
        <div class="alert alert-info my-2">
          âª This session was previously
          marked <strong>{{ session_status }}</strong>
          on {{ actual_session.date }}. <br>
          It is still pending and needs to be conducted.
        </div>
      {% endif %}
    {% endif %}

    <!-- Video -->
    {% if video_id %}
      <div class="ratio ratio-16x9 my-3">
        <iframe
          src="https://www.youtube.com/embed/{{ video_id }}"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>
    {% else %}
      <div class="alert alert-warning my-3">
        âš ï¸ Video unavailable or embedding disabled.
      </div>
    {% endif %}

    <!-- Actions -->
    <div class="d-flex gap-2 mt-3">

      {% if session_status == "pending" %}
        <!-- Normal pending session -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <button class="btn btn-success btn-sm">
            Conduct Session
          </button>
        </form>

        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="holiday">
          <button class="btn btn-outline-warning btn-sm">
            Mark Holiday
          </button>
        </form>

        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="cancelled">
          <button class="btn btn-outline-secondary btn-sm">
            Cancel Session
          </button>
        </form>

      {% elif is_today %}
        <!-- SAME-DAY holiday/cancelled â€” DO NOT allow conduct -->
        <div class="alert alert-warning">
          ğŸš« Today is marked {{ session_status }}.  
          This session will be taken next working day.
        </div>

      {% else %}
        <!-- Conduct later (shifted session) -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="conducted">
          <button class="btn btn-success btn-sm">
            Conduct Session Now
          </button>
        </form>
      {% endif %}
    </div>

  </div>
</div>

{% else %}
<div class="alert alert-success">
  ğŸ‰ All planned sessions are completed.
</div>
{% endif %}

{% endblock %}
