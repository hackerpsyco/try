{% extends "facilitator/shared/base.html" %}

{% block content %}
<h5 class="fw-bold mb-3">
  {{ class_section.class_level }} - Today‚Äôs Session
</h5>

{% if planned_session %}
<div class="card shadow-sm">
  <div class="card-body">

    <div class="d-flex justify-content-between align-items-center mb-2">
      <span class="badge bg-primary">
        Day {{ planned_session.day_number }}
      </span>
      
      {% if session_status == 'holiday' %}
        <span class="badge bg-warning">Previously marked as Holiday</span>
      {% elif session_status == 'cancelled' %}
        <span class="badge bg-danger">Previously marked as Cancelled</span>
      {% elif session_status == 'pending' %}
        <span class="badge bg-success">Ready to Start</span>
      {% endif %}
    </div>

    <h6 class="fw-semibold">
      {{ planned_session.topic }}
    </h6>

    {% if session_status == 'holiday' or session_status == 'cancelled' %}
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> 
        This session was previously marked as {{ session_status }}. 
        {% if session_status == 'holiday' %}
          You can conduct it now or leave it as holiday.
        {% else %}
          You can conduct it now or leave it as cancelled.
        {% endif %}
      </div>
    {% endif %}

    {% if video_id %}
<div class="ratio ratio-16x9 my-3">
  <iframe
    src="https://www.youtube.com/embed/{{ video_id }}"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen>
  </iframe>
</div>
{% else %}
<div class="alert alert-warning">
  ‚ö†Ô∏è Video unavailable or embedding disabled
</div>
{% endif %}

    <div class="d-flex gap-2 mt-3">
      {% if session_status == 'pending' %}
        <!-- Normal pending session buttons -->
        <!-- Conducted -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <button class="btn btn-success btn-sm">
            Conduct Session
          </button>
        </form>

        <!-- Holiday -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="holiday">
          <button class="btn btn-outline-danger btn-sm">
            Mark Holiday
          </button>
        </form>

        <!-- Cancel -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="cancelled">
          <button class="btn btn-outline-secondary btn-sm">
            Cancel
          </button>
        </form>
      {% else %}
        <!-- Previously marked as holiday/cancelled - allow conducting now -->
        <form method="post" action="{% url 'start_session' planned_session.id %}">
          {% csrf_token %}
          <input type="hidden" name="status" value="conducted">
          <button class="btn btn-success btn-sm">
            Conduct Session Now
          </button>
        </form>
        
        <div class="text-muted small mt-2">
          This session was previously {{ session_status }}. You can conduct it now if needed.
        </div>
      {% endif %}
    </div>

  </div>
</div>

{% else %}
<div class="alert alert-success">
  üéâ All planned sessions completed
</div>

<div class="mt-3">
  <a href="{% url 'debug_sessions' class_section.id %}" class="btn btn-outline-info">
    üîç Debug: View All Sessions
  </a>
</div>
{% endif %}

{% endblock %}
