{% extends 'admin/shared/base.html' %}

{% block title %}Students · {{ school.name }}{% endblock %}

{% block content %}

<!-- Back button -->
<button onclick="window.history.back();"
        class="px-3 py-1.5 mb-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 text-sm">
  ← Back
</button>

<!-- Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">

  <h4 class="text-xl font-bold text-gray-900">
    {{ school.name }}
    <span class="text-gray-400 font-normal">/ Students</span>
  </h4>

  <div class="flex gap-2">
    <a href="{% url 'student_add' school.id %}"
       class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">
      ➕ Add Student
    </a>

    <a href="{% url 'student_import' school.id %}"
       class="px-4 py-2 border border-green-600 text-green-700 rounded-lg text-sm hover:bg-green-50">
      ⬆ Import CSV / Excel
    </a>
  </div>

</div>

<!-- Filter -->
<form method="get" class="mb-5">
  <label class="block text-sm font-medium text-gray-700 mb-1">
    Class & Section
  </label>

  <select name="class_section"
          onchange="this.form.submit()"
          class="w-full max-w-sm px-4 py-2.5 border border-gray-300 rounded-lg
                 focus:outline-none focus:ring-2 focus:ring-blue-500">
    <option value="">All</option>

    {% for cs in class_sections %}
      <option value="{{ cs.id }}"
        {% if selected_class_section == cs.id|stringformat:'s' %}selected{% endif %}>
        {{ cs.class_level }} {{ cs.section }}
      </option>
    {% endfor %}
  </select>
</form>

<!-- Student Table -->
<div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50 text-sm text-gray-600">
        <tr>
          <th class="px-4 py-2 text-left font-semibold">#</th>
          <th class="px-4 py-2 text-left font-semibold">Enrollment</th>
          <th class="px-4 py-2 text-left font-semibold">Name</th>
          <th class="px-4 py-2 text-left font-semibold">Class</th>
          <th class="px-4 py-2 text-left font-semibold">Gender</th>
          <th class="px-4 py-2 text-left font-semibold">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">

      {% for e in enrollments %}
        <tr class="hover:bg-gray-50">

          <td class="px-4 py-2">{{ forloop.counter }}</td>

          <td class="px-4 py-2 text-gray-800">
            {{ e.student.enrollment_number }}
          </td>

          <td class="px-4 py-2 text-gray-900 font-medium">
            {{ e.student.full_name }}
          </td>

          <td class="px-4 py-2">
            {{ e.class_section.class_level }} {{ e.class_section.section }}
          </td>

          <td class="px-4 py-2">
            {{ e.student.gender }}
          </td>

          <td class="px-4 py-2">

            <div class="flex gap-2">

              <a href="{% url 'student_edit' school.id e.student.id %}"
                 class="px-3 py-1.5 border border-blue-500 text-blue-600 rounded-lg text-xs hover:bg-blue-50">
                Edit
              </a>

              <form action="{% url 'student_delete' school.id e.student.id %}"
                    method="post"
                    onsubmit="return confirm('Delete this student?')">
                {% csrf_token %}
                <button
                  class="px-3 py-1.5 border border-red-500 text-red-600 rounded-lg text-xs hover:bg-red-50">
                  Delete
                </button>
              </form>

            </div>

          </td>

        </tr>

      {% empty %}
        <tr>
          <td colspan="6" class="text-center text-gray-500 py-6">
            No students found
          </td>
        </tr>
      {% endfor %}

      </tbody>
    </table>
  </div>

</div>

{% endblock %}
