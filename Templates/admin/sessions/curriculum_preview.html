{% extends "admin/shared/base.html" %}
{% load static %}

{% block content %}
<div class="space-y-6">
    <!-- Preview Header -->
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-blue-600 text-2xl">visibility</span>
                <div>
                    <h5 class="text-lg font-semibold text-blue-800">Preview Mode</h5>
                    <p class="text-sm text-blue-700">This is how the session will appear to facilitators</p>
                </div>
            </div>
            <div class="flex gap-2">
                <a href="{% url 'admin_curriculum_session_edit' session.id %}" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">
                    <span class="material-symbols-outlined text-lg mr-1">edit</span>
                    Edit Session
                </a>
                <a href="{% url 'admin_curriculum_sessions_list' %}" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm font-medium">
                    <span class="material-symbols-outlined text-lg mr-1">arrow_back</span>
                    Back to List
                </a>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
                {% if prev_session %}
                    <a href="{% url 'admin_curriculum_session_preview' prev_session.id %}" 
                       class="px-4 py-2 border border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 text-sm font-medium">
                        <span class="material-symbols-outlined text-lg mr-1">chevron_left</span>
                        Day {{ prev_session.day_number }}
                    </a>
                {% else %}
                    <button class="px-4 py-2 border border-gray-300 text-gray-400 rounded-lg text-sm font-medium" disabled>
                        <span class="material-symbols-outlined text-lg mr-1">chevron_left</span>
                        Previous
                    </button>
                {% endif %}
            </div>
            
            <div class="text-center">
                <h4 class="text-xl font-bold text-gray-900">{{ session.get_language_display }} Curriculum</h4>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    Day {{ session.day_number }}
                </span>
            </div>
            
            <div>
                {% if next_session %}
                    <a href="{% url 'admin_curriculum_session_preview' next_session.id %}" 
                       class="px-4 py-2 border border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 text-sm font-medium">
                        Day {{ next_session.day_number }}
                        <span class="material-symbols-outlined text-lg ml-1">chevron_right</span>
                    </a>
                {% else %}
                    <button class="px-4 py-2 border border-gray-300 text-gray-400 rounded-lg text-sm font-medium" disabled>
                        Next
                        <span class="material-symbols-outlined text-lg ml-1">chevron_right</span>
                    </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Session Content (Facilitator View) -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                <h3 class="text-xl font-bold text-gray-900">{{ session.title }}</h3>
                <div class="flex gap-2">
                    {% if session.status == 'published' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Published</span>
                    {% elif session.status == 'draft' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Draft</span>
                    {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Archived</span>
                    {% endif %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">{{ session.get_language_display }}</span>
                </div>
            </div>
        </div>
        <div class="p-6 space-y-6">
            {% if session.learning_objectives %}
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-green-600 text-xl">target</span>
                        <h5 class="text-lg font-semibold text-gray-900">Learning Objectives</h5>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="text-gray-700 whitespace-pre-line">{{ session.learning_objectives }}</div>
                    </div>
                </div>
            {% endif %}

            {% if session.content %}
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-blue-600 text-xl">menu_book</span>
                        <h5 class="text-lg font-semibold text-gray-900">Session Content</h5>
                    </div>
                    <div class="prose max-w-none">
                        <div class="text-gray-700 whitespace-pre-line leading-relaxed">{{ session.content }}</div>
                    </div>
                </div>
            {% endif %}

            {% if session.activities %}
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-orange-600 text-xl">assignment</span>
                        <h5 class="text-lg font-semibold text-gray-900">Activities</h5>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 whitespace-pre-wrap">{{ session.activities|pprint }}</pre>
                    </div>
                </div>
            {% endif %}

            {% if session.resources %}
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="material-symbols-outlined text-purple-600 text-xl">folder</span>
                        <h5 class="text-lg font-semibold text-gray-900">Resources</h5>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 whitespace-pre-wrap">{{ session.resources|pprint }}</pre>
                    </div>
                </div>
            {% endif %}

            <!-- Session Metadata -->
            <div class="pt-6 border-t border-gray-200">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-500">
                    <div>
                        <strong>Created:</strong> {{ session.created_at|date:"M d, Y H:i" }}
                        {% if session.created_by %} by {{ session.created_by.full_name }}{% endif %}
                    </div>
                    <div class="sm:text-right">
                        <strong>Last Updated:</strong> {{ session.updated_at|date:"M d, Y H:i" }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Statistics (Admin Only) -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200">
            <h5 class="text-lg font-semibold text-gray-900">
                <span class="material-symbols-outlined text-lg mr-2">analytics</span>
                Session Statistics
            </h5>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 mb-1">{{ session.usage_logs.count }}</div>
                    <div class="text-sm text-gray-500">Total Views</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600 mb-1">{{ session.version_history.count }}</div>
                    <div class="text-sm text-gray-500">Versions</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600 mb-1">
                        {% if session.usage_logs.exists %}
                            {{ session.usage_logs.first.access_timestamp|date:"M d" }}
                        {% else %}
                            Never
                        {% endif %}
                    </div>
                    <div class="text-sm text-gray-500">Last Accessed</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600 mb-1">
                        {% if session.template %}
                            <span class="material-symbols-outlined">check</span>
                        {% else %}
                            <span class="material-symbols-outlined">close</span>
                        {% endif %}
                    </div>
                    <div class="text-sm text-gray-500">Template Used</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.prose {
    font-size: 16px;
    line-height: 1.7;
}

.prose h1, .prose h2, .prose h3 {
    color: #1f2937;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
}

.prose ul, .prose ol {
    margin-left: 1.5rem;
}

.prose blockquote {
    border-left: 4px solid #3b82f6;
    padding-left: 1rem;
    margin: 1rem 0;
    background-color: #f8fafc;
    padding: 1rem;
}
</style>
{% endblock %}
