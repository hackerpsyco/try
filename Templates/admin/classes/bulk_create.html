{% extends 'admin/shared/base.html' %}

{% block title %}Create Multiple Classes{% endblock %}

{% block content %}
<div class="py-6 max-w-4xl mx-auto">
    
    <!-- Page Header -->
    <div class="mb-6">
        <button onclick="window.history.back()" class="inline-flex items-center gap-2 px-3 py-2 mb-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">
            ◀ Back
        </button>
        <h1 class="text-3xl font-bold text-gray-900">Create Multiple Classes</h1>
        <p class="text-gray-500 mt-1">Create 1-10 new classes at once</p>
    </div>

    <!-- Form -->
    <form method="POST" class="bg-white border border-gray-200 rounded-xl shadow-sm p-6 space-y-6">
        {% csrf_token %}
        
        <!-- School Selection -->
        <div>
            <label for="school_id" class="block text-sm font-medium text-gray-700 mb-2">
                School <span class="text-red-500">*</span>
            </label>
            <select id="school_id" 
                    name="school_id" 
                    required
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">-- Select a School --</option>
                {% for school in schools %}
                    <option value="{{ school.id }}" {% if selected_school.id == school.id %}selected{% endif %}>{{ school.name }}</option>
                {% endfor %}
            </select>
            <p class="text-xs text-gray-500 mt-1">Choose the school where you want to create classes</p>
        </div>

        <!-- Classes Input Grid -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">
                New Classes <span class="text-red-500">*</span>
                <span class="text-xs text-gray-500 font-normal ml-2">(<span id="classCount">1</span>/10)</span>
            </label>
            
            <div id="classesContainer" class="space-y-3">
                <!-- Class input will be added here -->
            </div>
            
            <button type="button" id="addClassBtn" class="mt-3 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50 transition-colors">
                + Add Another Class
            </button>
            <p class="text-xs text-gray-500 mt-2">You can create up to 10 classes at a time</p>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center justify-between pt-4 border-t border-gray-200">
            <button type="button" onclick="window.history.back()" 
                    class="px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors font-medium text-sm">
                Cancel
            </button>
            <button type="submit" 
                    class="flex items-center gap-2 px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors font-medium text-sm shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
                    id="submitBtn"
                    disabled>
                <span>✓</span>
                <span>Create Classes</span>
            </button>
        </div>
    </form>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const container = document.getElementById("classesContainer");
    const addBtn = document.getElementById("addClassBtn");
    const submitBtn = document.getElementById("submitBtn");
    const countSpan = document.getElementById("classCount");
    const schoolSelect = document.getElementById("school_id");
    
    // Add first class input
    addClassInput();
    
    addBtn.addEventListener("click", function(e) {
        e.preventDefault();
        const count = container.querySelectorAll(".class-input-group").length;
        if (count < 10) {
            addClassInput();
        } else {
            alert("Maximum 10 classes allowed");
        }
    });
    
    schoolSelect.addEventListener("change", updateSubmitBtn);
    
    function addClassInput() {
        const count = container.querySelectorAll(".class-input-group").length + 1;
        const html = `
            <div class="class-input-group p-4 bg-gray-50 border border-gray-200 rounded-lg space-y-3">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">Class ${count}</span>
                    ${count > 1 ? `<button type="button" class="remove-class text-red-600 hover:text-red-700 text-sm font-medium">Remove</button>` : ''}
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Class Level <span class="text-red-500">*</span></label>
                        <input type="text" 
                               name="class_level" 
                               placeholder="e.g., Grade 5" 
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Section <span class="text-red-500">*</span></label>
                        <input type="text" 
                               name="section" 
                               placeholder="e.g., A" 
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-medium text-gray-600 mb-1">Academic Year <span class="text-red-500">*</span></label>
                    <input type="text" 
                           name="academic_year" 
                           placeholder="e.g., 2024-2025" 
                           required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                </div>
            </div>
        `;
        
        container.insertAdjacentHTML("beforeend", html);
        updateCount();
        
        // Add remove button listener
        const removeBtn = container.querySelector(".class-input-group:last-child .remove-class");
        if (removeBtn) {
            removeBtn.addEventListener("click", function(e) {
                e.preventDefault();
                this.closest(".class-input-group").remove();
                updateCount();
            });
        }
    }
    
    function updateCount() {
        const count = container.querySelectorAll(".class-input-group").length;
        countSpan.textContent = count;
        addBtn.disabled = count >= 10;
        updateSubmitBtn();
    }
    
    function updateSubmitBtn() {
        const hasSchool = schoolSelect.value !== "";
        const hasClasses = container.querySelectorAll(".class-input-group").length > 0;
        submitBtn.disabled = !hasSchool || !hasClasses;
    }
});
</script>

{% endblock %}
